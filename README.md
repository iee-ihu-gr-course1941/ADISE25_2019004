# ADISE25_2019004
To project υλοποιεί ψηφιακά το ελληνικό παιχνίδι καρτών Ξερή για δύο παίκτες. Οι παίκτες μπορούν να συνδεθούν μέσω του web interface, να παίξουν σε πραγματικό χρόνο, να βλέπουν τα φύλλα τους, τα φύλλα στο τραπέζι και τα φύλλα που έχουν πάρει, ενώ το σύστημα διαχειρίζεται αυτόματα τη σειρά παιξίματος, την ανακατανομή των φύλλων από τη τράπουλα και τον υπολογισμό των πόντων. Το παιχνίδι υποστηρίζει την έναρξη, την επαναφορά και την έξοδο παικτών, κρατώντας το παιχνίδι ασφαλές με τη χρήση token-based authentication.

Τα αρχεία του project είναι:
1) db.php του οποίου ο ρόλος είναι η σύνδεση με τη βάση δεδομένων MySQL,η δημιουργία ένος PDO αντικείμενο για χρήση από όλα τα άλλα scripts και η χρήση του από τα game.php, move.php, login.php για όλες τις database queries.

2) game.php του οποίου ο ρόλος είναι να είναι το κύριο Web API για login και ανάκτηση κατάστασης παιχνιδιού και διαχειρίζεται:
Σύνδεση/δημιουργία παίκτη (username) και δημιουργία token
Έλεγχο αν χρειάζεται να δημιουργηθεί ή να ανανεωθεί η τράπουλα και τα χέρια των παικτών
Ενημέρωση σειράς παιξίματος και κατάστασης πίνακα (waiting, active, finished)
Επιστρέφει JSON με τρέχουσα κατάσταση παιχνιδιού, χέρια, τραπέζι, συλλογές, γύρους, turn και παίκτες

3) move.php του οποίου ο ρόλος είναι να είναι το Web API για εκτέλεση κινήσεων/ενέργειες παικτών και διαχειρίζεται:
Παίξιμο φύλλου και υπολογισμό capture/XERI
Επαναφορά παιχνιδιού (reset_game)
Έξοδο παίκτη (leave)
Προχωρά στη επόμενη σειρά (turn) και αυξάνει γύρο όταν χρειάζεται
Ελέγχει το τέλος παιχνιδιού και υπολογίζει τελικό σκορ
Επιστρέφει JSON με αποτέλεσμα κίνησης και κατάσταση παιχνιδιού

4) login.php του οποίου ο ρόλος είναι να είναι ένα εναλλακτικό Web API για login/δημιουργία παίκτη και διαχειρίζεται:
Δημιουργία παίκτη με μοναδικό token
Έλεγχο αν το παιχνίδι είναι πλήρες (2 παίκτες)
Αρχικοποίηση του board όταν μπαίνει ο δεύτερος παίκτης
Μπορεί να χρησιμοποιηθεί αντί του game.php για login, αλλά το κύριο API είναι το game.php

5) index.html το οποίο είναι ένα προαιρετικό frontend GUI για το παιχνίδι και διαχειρίζεται:
Εισαγωγή username και σύνδεση μέσω game.php.
Προβολή χεριού παίκτη, τραπεζιού, συλλογών, γύρων, turn και deck.
Αλληλεπίδραση χρήστη (κλικ σε κάρτα με το move.php).
Αυτόματη ενημέρωση κατάστασης κάθε 2 δευτερόλεπτα.

Το WebAPI μας επιτρέπει να επικοινωνούμε με τον server μέσω διαδικτύου.
Αυτο το καταφέρνει στέλνοντας αιτήματα(requests) στον server με HTTP POST ή GET και χρησιμοποιεί συνήθως JSON δεδομένα.
Ο server εκτελεί το κώδικα της εφαρμογής, αλληλεπιδρά με τη βάση δεδομένων και επιστρέφει JSON απαντήσεις (responses).
Με λίγα λόγια, το Web API απομονώνει τη βάση δεδομένων και δίνει στους χρήστες ένα ασφαλές και δομημένο τρόπο να παίζουν το παιχνίδι.

Στα αρχεία το API χρησιμοποιείται ως:
1) Στο game.php όπου συνδέει ένα νέο ή υπάρχοντα παίκτη στο παιχνίδι κάνοντας request(JSON) με username και λαμβάνοντας response(JSON) με τα στοιχεία του παίκτη όπως το username,player_id και το token του.
Επίσης στο ίδιο αρχείο επιστρέφει την τρέχουσα κατάσταση του πίνακα: φύλλα παικτών, τραπέζι, συλλογές, γύρους, σειρά, τράπουλα με τη χρήση request(JSON) με token και λαμβάνει response(JSON) τα στοιχεία current_turn,round,deck_count,player_hand,player_captured,table_pile[],status,final_score,winner και players[].

2) Στο move.php το API βοηθαεί να παίξει ένας παίκτης κάποιο χαρτί με request όπου παίρνει token και card και ελέγχει:
{2.1} Ελέγχει αν είναι η σειρά του παίκτη
{2.2} Ελέγχει αν το φύλλο υπάρχει στο χέρι
{2.3} Υπολογίζει capture / XERI σύμφωνα με τους κανόνες
{2.4}- Ενημερώνει τη βάση δεδομένων (board, players)
και επιστρέφει response {"status":"ok","captured":true,"xeri":false}
Ακόμα επαναφέρει το παιχνίδι στην αρχική του κατάσταση με request token και action οπου το action τωρα θα είναι "reset_game" και ανακατεύει τη τράπουλα,μοιράζει χαρτιά στα χέρια και καθαρίζει στοιχεία του προηγούμενου παιχνιδιού επιστρέφοντας response {"status":"ok"} 
Το τελευταίο που κάνει είναι η έξοδος παίκτη από το παιχνίδι με request token και action "leave" όπου αφαιρεί το παίκτη από τη βάση και άμα αυτο γίνει καθώς ένα παιχνίδι βρίσκεται σε εξέλιξη τότε ο άλλος παίκτης είναι ο νικητής και επιστρέφει response {"status":"ok"}

3) Στο login.php το API δημιουργεί το παίκτη ή αλλιώς επιστρέφει το token του και άμα είναι ο δεύτερος παίκτης τότε αρχικοποιεί το παιχνίδι.
